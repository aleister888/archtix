#!/bin/sh

# Directorio de respaldo
backup_dir="/opt/wine_backups"

# Verifica si el directorio de respaldo existe
if [ ! -d "$backup_dir" ]; then
	echo "El directorio de respaldo $backup_dir no existe."
	exit 1
fi

# Crea un archivo tar con la fecha actual
tar_file="$backup_dir/$(date +%d_%m_%Y__%H_%S).tar"
tar -cvf "$tar_file" -C /home/aleister/.config/ wineprefixes

# Verifica si la creación del archivo tar fue exitosa
if [ $? -ne 0 ]; then
	echo "Error: No se pudo crear el archivo tar."
	exit 1
fi

# Elimina archivos en el directorio de respaldo que tengan más de 1 día de antigüedad
find "$backup_dir"/* -mtime +1 -delete

# Verifica si la eliminación de archivos fue exitosa
if [ $? -eq 0 ]; then
	echo "Operaciones completadas exitosamente."
else
	echo "Error: No se pudo eliminar los archivos antiguos."
fi
