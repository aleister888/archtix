#!/usr/bin/zsh

# Función para imprimir $2 si $1 es un texto vacío
withSafe() {
	local txt="$1"
	local safe="$2"

# Verificar si el primer argumento está vacío o nulo
	if [[ -z "$txt" ]]; then
	echo "$safe"
	else
	echo "$txt"
	fi
}

# Función para pausar o reanudar la reproducción
togglePlayPause() {
	local isPaused
	isPaused="$(curl -s "http://localhost:7814/api1/status" | grep -c paused 2>&1)"
	if [ "$isPaused" -eq 0 ]; then
		curl "http://localhost:7814/api1/pause"
	else
		curl "http://localhost:7814/api1/play"
	fi
}

# Función para obtener la ruta de la carátula del álbum o una imagen de marcador de posición
getCover() {
	tauon-remote localhost cover
	if [ -e "/tmp/cover.jpg" ]; then
		echo "/tmp/cover.jpg"
	else
		echo "$HOME/.local/bin/eww/placeholder.png"
	fi
}

# Acciones basadas en el argumento pasado
case $1 in
	play-pause)
		togglePlayPause
		;;
	get)
		getCover
		;;
	status)
		echo "$(curl -s "http://localhost:7814/api1/status" | sed 's/,/\\n/g')" | grep status | sed -e 's/{"status": //g' -e 's/"//g' -e 's/\b\w/\U&/'
		;;
	artist)
		withSafe "$(echo "$(curl -s "http://localhost:7814/api1/status" | sed 's/,/\\n/g')" | grep '"artist"' | head -1 | sed -e 's/ "artist": "//g' -e 's/"//g' | cut -c1-22)" "Cannot detect artist"
		;;
	title)
		withSafe "$(echo "$(curl -s "http://localhost:7814/api1/status" | sed 's/,/\\n/g')" | grep '"title"' | head -1 | sed -e 's/ "title": "//g' -e 's/"//g' | cut -c1-15)" "Player Stopped"
		;;
	*)
		echo "Usage: $0 {play-pause|get}"
		exit 1
		;;
esac
