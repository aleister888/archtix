#!/bin/bash

if doas btrfs subvolume show /swap &>/dev/null; then
	doas swapoff /swap/swapfile
	doas btrfs subvolume delete /swap
fi

doas rm -rf /swap
doas btrfs subvolume create /swap
doas btrfs filesystem mkswapfile \
	--size "$(($(free -g | grep Mem: | awk '{print $2}')+4))g" \
	--uuid clear /swap/swapfile
doas swapon /swap/swapfile
