#!/bin/sh

SERVERDIR="/opt/minecraft-server"

# Crear directorio con el servidor
sudo mkdir -p $SERVERDIR
sudo chown $USER:$USER $SERVERDIR
cd $SERVERDIR

# Descargar instalador
curl -OJ https://meta.fabricmc.net/v2/versions/loader/1.21.4/0.16.10/1.0.1/server/jar
java -Xmx2G -jar fabric-server-mc.1.21.4-loader.0.16.10-launcher.1.0.1.jar server

# Aceptar EULA
sed -i 's/eula=false/eula=true/' $SERVERDIR/eula.txt

##################
# Descargar mods #
##################

# https://modrinth.com/mod/lithium
curl -O "https://cdn.modrinth.com/data/gvQqBUqZ/versions/zVOQw7YU/lithium-fabric-0.14.6%2Bmc1.21.4.jar" \
	--output-dir $SERVERDIR/mods/
# https://modrinth.com/mod/modernfix
curl -O "https://cdn.modrinth.com/data/nmDcB62a/versions/gx7PIV8n/modernfix-fabric-5.20.1%2Bmc1.21.4.jar" \
	--output-dir $SERVERDIR/mods/
# https://modrinth.com/mod/krypton
curl -O "https://cdn.modrinth.com/data/fQEb0iXm/versions/Acz3ttTp/krypton-0.2.8.jar"\
	--output-dir $SERVERDIR/mods/
# https://modrinth.com/mod/c2me-fabric
curl -O "https://cdn.modrinth.com/data/VSNURh3q/versions/yGX4O0YU/c2me-fabric-mc1.21.4-0.3.1.1.0.jar" \
	--output-dir $SERVERDIR/mods/
# https://modrinth.com/mod/noisium
curl -O "https://cdn.modrinth.com/data/KuNKN7d2/versions/9NHdQfkN/noisium-fabric-2.5.0%2Bmc1.21.4.jar" \
	--output-dir $SERVERDIR/mods/
# https://modrinth.com/mod/toms-mobs
curl -O "https://cdn.modrinth.com/data/PXaH6GuW/versions/YbEti9ns/toms_mobs-2.1.4%2B1.21.4.jar" \
	--output-dir $SERVERDIR/mods/

####################
# Crear ejecutable #
####################

cat <<- EOF | doas tee /usr/local/bin/mc-server-start
	#!/bin/sh

	cd $SERVERDIR
	java -Xmx4G -jar fabric-server-mc.1.21.4-loader.0.16.10-launcher.1.0.1.jar
EOF

sudo chmod +x /usr/local/bin/mc-server-start
