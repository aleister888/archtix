#!/bin/bash
# https://github.com/yuk7/ArchWSL

yay_install(){
	if ! pacman -Q yay >/dev/null 2>&1; then
		sudo pacman -Sy --noconfirm --disable-download-timeout --needed git base-devel
		local tmp_dir="/tmp/yay_install_temp"
		mkdir -p "$tmp_dir"
		git clone https://aur.archlinux.org/yay.git "$tmp_dir"
		sh -c "cd $tmp_dir && makepkg -si --noconfirm"
	fi
}

get_repo(){
	if [ ! -d "$HOME/.local/share/dots" ]; then
		mkdir -p "$HOME/.local/share"
		git clone --branch dev --single-branch \
			https://github.com/aleister888/artixRC-dotfiles.git \
			"$HOME/.local/share/dots"
	else
		sh -c "cd $HOME/.local/share/dots && git pull"
	fi
}

# Funcion para configurar neovim
nvim_setup(){
	yay -Sy --noconfirm --disable-download-timeout --needed \
		neovim python-pynvim nodejs

	if [ ! -d "$HOME/.config/nvim" ]; then
		mkdir -p ~/.config/nvim
		ln -s \
			"$HOME/.local/share/dots/assets/wsl/init.vim" \
			"$HOME/.config/nvim/init.vim"
	fi

	pacman -Q vim >/dev/null 2>&1 && \
		sudo pacman -Rcns --noconfirm vim

	sudo ln -sf /usr/bin/nvim /usr/local/bin/vim
}

yay_install
get_repo
nvim_setup
