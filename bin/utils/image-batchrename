#!/bin/bash

# Directorio base
base_dir="$HOME/Imágenes"

# Extensiones a buscar
extensions="jpg|jpeg|png|gif|bmp|tiff|ppm|svg|webp"

# Buscar y renombrar archivos en el directorio y subdirectorios
find "$base_dir" -type f -regextype posix-egrep -iregex ".*\.(($extensions))$" | while read -r file; do
	# Extraer el nombre del archivo
	filename=$(basename "$file")
	dirpath=$(dirname "$file")

	# Regex para el formato IMG_YYYYMMDD_HHMMSS
	if [[ $filename =~ IMG_([0-9]{4})([0-9]{2})([0-9]{2})_([0-9]{2})([0-9]{2})([0-9]{2})_.*\. ]]; then
		# Formatear el nuevo nombre
		extension="${file##*.}" # Extraer extensión
		new_name="${BASH_REMATCH[1]}-${BASH_REMATCH[2]}-${BASH_REMATCH[3]}_${BASH_REMATCH[4]}-${BASH_REMATCH[5]}-${BASH_REMATCH[6]}.$extension"
		new_path="$dirpath/$new_name"

		# Renombrar el archivo
		mv "$file" "$new_path"
		echo "Renamed: $file -> $new_path"

	# Regex para el formato DDMMYYYY_HHMMSS
	elif [[ $filename =~ ([0-9]{2})([0-9]{2})([0-9]{4})_([0-9]{2})([0-9]{2})([0-9]{2})\. ]]; then
		# Formatear el nuevo nombre
		extension="${file##*.}" # Extraer extensión
		new_name="${BASH_REMATCH[3]}-${BASH_REMATCH[2]}-${BASH_REMATCH[1]}_${BASH_REMATCH[4]}-${BASH_REMATCH[5]}-${BASH_REMATCH[6]}.$extension"
		new_path="$dirpath/$new_name"

		# Renombrar el archivo
		mv "$file" "$new_path"
		echo "Renamed: $file -> $new_path"

	# Regex para el formato Screenshot_YYYYMMDD-HHMMSS_AppName
	elif [[ $filename =~ Screenshot_([0-9]{4})([0-9]{2})([0-9]{2})-([0-9]{2})([0-9]{2})([0-9]{2})_.*\. ]]; then
		# Formatear el nuevo nombre
		extension="${file##*.}" # Extraer extensión
		new_name="${BASH_REMATCH[1]}-${BASH_REMATCH[2]}-${BASH_REMATCH[3]}_${BASH_REMATCH[4]}-${BASH_REMATCH[5]}-${BASH_REMATCH[6]}.$extension"
		new_path="$dirpath/$new_name"

		# Renombrar el archivo
		mv "$file" "$new_path"
		echo "Renamed: $file -> $new_path"
	fi
done

# Usar ExifTool para renombrar los archivos basándose en la fecha de creación
exiftool -r '-FileName<CreateDate' -d '%Y-%m-%d_%H-%M-%S.%%e' "$base_dir"
