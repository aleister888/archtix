#!/bin/bash

# Script para cambiar el brillo directamente usando /sys/class/backlight/intel_backlight/brightness
# (Solo funciona en portátiles con procesadores intel)

[ -f /sys/class/backlight/intel_backlight/max_brightness ] || exit 1

# Calcular el nuevo valor para el brillo
calculate_brightness() {
	local max="$1"
	local actual="$2"
	local percentage="$3"
	local gradient=50
	local new_brightness
	# Establecemos incrementos del 25%
	local increment=$((max / 4))
	# Calcular nuevo brillo en función del argumento que damos
	# y cambiarlo gradualmente
	if [ "$percentage" == "inc" ]; then
		new_brightness=$((actual + increment))
		while [ "$actual" -lt "$new_brightness" ] && [ "$actual" -le $(($max-$gradient)) ]; do
			actual=$((actual + $gradient))
			echo $actual | doas tee /sys/class/backlight/intel_backlight/brightness
		done
	elif [ "$percentage" == "dec" ]; then
		new_brightness=$((actual - increment))
		while [ "$actual" -gt "$new_brightness" ] && [ "$actual" -ge $gradient ]; do
			actual=$((actual - $gradient))
			echo $actual | doas tee /sys/class/backlight/intel_backlight/brightness
		done
	fi
}

max_brightness=$(cat /sys/class/backlight/intel_backlight/max_brightness)
current_brightness=$(cat /sys/class/backlight/intel_backlight/brightness)
calculate_brightness "$max_brightness" "$current_brightness" "$1"
# Calcular el brillo y redondearlo a multiplos de 25
result=$(awk "BEGIN {print (100 / $max_brightness * $(cat /sys/class/backlight/intel_backlight/brightness))}")
result=$(echo "scale=0; ($result + 24) / 25 * 25" | bc)

dunstctl close-all
notify-send -i brightness "Brillo: $result%"
