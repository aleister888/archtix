#!/bin/bash

# Calcular el nuevo valor para el brillo
calculate_brightness() {
	local max="$1"
	local actual="$2"
	local percentage="$3"
	# Calcular el 20% del brillo (No podremos bajar de este valor)
	local increment=$((max / 10 * 2))
	# Calcular nuevo brillo en funciÃ³n del argumento que damos
	if [ "$percentage" == "inc" ]; then
		new_brightness=$((actual + increment))
	elif [ "$percentage" == "dec" ]; then
		new_brightness=$((actual - increment))
	fi
	# Asegurarse que el nuevo brillo no baja de $increment
	# Ensure brightness stays within bounds
	if [ "$new_brightness" -lt "$increment" ]; then
		exit 1
	fi

	echo "$new_brightness"
}

max_brightness=$(cat /sys/class/backlight/*/max_brightness)
current_brightness=$(cat /sys/class/backlight/*/brightness)
new_brightness=$(calculate_brightness "$max_brightness" "$current_brightness" "$1")

echo "$new_brightness" | doas tee /sys/class/backlight/*/brightness 2>/dev/null
