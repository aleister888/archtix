#!/bin/bash

# Script para establecer la prioridad de los reproductores de música
# al usar music-control y music-priority

# Aquí se establece la prioridad de los reproductores:
priority=(
	"$BROWSER"
	"tauon"
)

# Lista de dominios permitidos para el navegador
allowed_domains=(
	"music.youtube.com"
	"open.spotify.com"
)

# Establecemos el reproductor y salimos del loop
for app in "${priority[@]}"; do

	case "$app" in
	# Si es el navegador, comprobamos que se está reproduciendo
	# contenido en uno de los dominios permitidos
	$BROWSER)
		# Convierte el array en una expresión regular
		domains_pattern=$(
			IFS=\|
			echo "${allowed_domains[*]}"
		)
		if playerctl -p "$BROWSER" metadata xesam:url 2>/dev/null |
			grep -qE "$domains_pattern"; then
			PLAYER=$app
			break
		fi
		;;
	*)
		if playerctl -p "$app" status >/dev/null 2>&1; then
			PLAYER=$app
			break
		fi
		;;
	esac

done

printf "%s" "$PLAYER"
